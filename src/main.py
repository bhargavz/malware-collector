#!/usr/bin/python
__author__ = 'emanuel'
import ConfigParser
import tweepy
import sys

#get the auth data
try:
  config = ConfigParser.ConfigParser()
  config.read('settings.cfg')
  consumer_key = config.get('twitter', 'consumer_key')
  consumer_secret_key = config.get('twitter', 'consumer_secret_key')
  access_token = config.get('twitter', 'access_token')
  access_secret_token = config.get('twitter', 'access_secret_token')
except ConfigParser.NoSectionError:
  sys.stderr.write("Could not open 'settings.cfg'\n")
  sys.stderr.write("Exiting...\n")
  sys.exit(1)

#TODO save into RAMDISK

filename = "data.txt"

#consumer key, consumer secret
auth = tweepy.OAuthHandler(consumer_key, consumer_secret_key)

#access token, access token secret
auth.set_access_token(access_token, access_secret_token)

api = tweepy.API(auth)
#Brazil = 455819
brazil_trends = api.trends_place(455819)

mytrends = []
for trends in brazil_trends:
  #for key, value in trends.iteritems():
  for each_trend in trends['trends']:
    mytrends.append(each_trend['name'])
    print each_trend['name']
    print each_trend['url']
    print

#res = api.search("CBLOL", rpp=100)

myfile = open(filename, "w")
myfile.write("Results for : " + mytrends[0] + '\n')

#
#for i in range(res.count):
#  print res[i].text.encode('utf-8')
#  myfile.write(str(res[i].text.encode('utf-8')))
#  myfile.write("\n\n")
#  print "\n\n"
#sys.exit(0)
max_tweets=100
#we have 10 trends mytrends[0] .. mytrends[9]
query=mytrends[0]
searched_tweets = [status._json for status in tweepy.Cursor(api.search,  q=query).items(max_tweets)]

for item in searched_tweets:
  print item['text']
  myfile.write(item['text'].encode('utf-8'))


myfile.close()
