import pymongo
import geopy
import folium
import time

from geopy import geocoders
class LocationFinder():
	client = pymongo.MongoClient("localhost", 27017)
	db = client.dbtesting
	
	def getLocation(self):
		return LocationFinder.db.tweets.find({'location': {'$ne': None}}, {'_id':0, 'location':1})
	def saveLocations(self, f):
		for tweet in self.getLocation():
			#print tweet
			location = tweet['location']
			print location
			geoLocator = geocoders.GoogleV3(api_key='AIzaSyB4zzXZOJ9KG3GatRlpdf63YpMxCCSPz-k')

			try:
				geocode = geoLocator.geocode(query=location, exactly_one=True)
				time.sleep(0.1);
				if geocode != None:
					print ((geocode.latitude, geocode.longitude))
					f.write(str(geocode.latitude)+' '+str(geocode.longitude)+"\n")
					print 'Written!'
				continue
			except:
				continue	

f = open('places', 'w')
lf = LocationFinder()
lf.saveLocations(f)
f.close();

